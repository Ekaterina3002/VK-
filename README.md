# Лабораторная работа № 1 — анализ дружеской сети VK

## Задача
- Собрать данные о друзьях и друзьях друзей членов учебной группы.
- Рассчитать центральности (посредничество, гармоническая близость, собственный вектор) для участников группы.
- Подготовить признаки для будущей модели прогноза дружбы.
- Дополнительно к центральности в графе необходимо сделать модель прогноза кто с кем дружит 

## Обработка и анализ
В ноутбуке `Lab_AI-1.ipynb`:
- Строятся эго-графы (эго + друзья + друзья друзей).
- Считаются центральности через NetworkX и NetworKit.
- Добавляются ранги/перцентили центральностей внутри каждого эго-графа.
- Результаты сохраняются в `centrality_ego_all_nodes.csv` и `centrality_ego_group_only.csv`.
- Генерируются визуализации подграфов (k-core, порог по степени, топ по центральности) и сохраняются как `ego_*.png`.

## Расчёт центральностей

Для каждого участника группы были рассчитаны следующие метрики:

#### 1. **Посредничество (Betweenness Centrality)**  
Оценивает, насколько пользователь важен как «посредник» между другими участниками сети.  
Чем выше значение, тем чаще пользователь оказывается на кратчайших путях между другими.


#### 2. **Близость (Closeness Centrality)**  
Оценивает среднюю «дистанцию» от пользователя до остальных участников.  
В данной работе используется **гармоническая близость**, устойчивая к несвязным компонентам.


#### 3. **Собственный вектор (Eigenvector Centrality)**  
Показывает, насколько пользователь связан с другими «важными» участниками графа.  
Высокое значение означает, что пользователь имеет авторитетных соседей.

### Формат выходных данных

Результаты сохранены в виде таблицы (DataFrame), содержащей:

| id (VK ID)   | betweenness | closeness | eigenvector |
|--------------|-------------|-----------|-------------|
| 493202460    |0.009570720483348642| 0.3476141451976673 | 0.0014196884266065087       |
| 251116606    | 0.8324515695134754 | 1.0     |0.012253296323705545        |
| 296351219    |  0.009652549729210773          |       0.43493630691759405    |        0.0038069754772412936     |

### Назначение

Расчёт центральностей позволяет:
- выявить наиболее влиятельных членов группы;
- оценить их положение в социальной сети;
- использовать метрики как признаки для модели предсказания дружбы.


## Сбор данных
- `data/users.csv` — анкеты: ID, имя, местоположение, возраст, учеба, работа, списки друзей и групп.
- `data/friends.csv` — дружеские связи внутри собранного множества.
- `data/groups.csv` — связи «пользователь — сообщество».
- `data/features.csv` — признаки для пар пользователей (общие друзья и группы, совпадения по атрибутам и т. д.).

### Ограничения
- Сбор работает только для открытых профилей VK.
- API ограничивает частоту запросов, поэтому используется задержка между вызовами.
- Результаты центральностей зависят от доступности данных друзей друзей.

### Модель для прогноза дружбы
Использовали модель градиентного бустинга из библиотеки CatBoost (логлосс, AUC), где для каждой пары пользователей есть некоторые признаки.

Признаки:
- common_friends (число общих друзей) — просто сколько идентичных друзей у обоих пользователей.
- jaccard_friends (Jaccard similarity по друзьям) — доля пересечения списков друзей; показывает, насколько сильно круг общения совпадает относительно общего количества друзей.
- adamic_adar (Adamic–Adar index) — взвешенная сумма по общим друзьям, где каждый общий друг даёт вклад, обратно пропорциональный числу его друзей; акцентирует редких «мостиков».
- same_city, same_university, same_faculty, same_school — бинарные признаки, указывают, есть ли совпадение по городу проживания, вузу, факультету или школе.
- age_diff — абсолютная разница в возрасте (лет); чем меньше, тем больше шанс дружбы среди реальных пользователей.
- common_groups, jaccard_groups (Jaccard similarity по группам) — аналогичные метрики, но по сообществам/группам, чтобы показать, насколько совпадают интересы.

Модель обучается с весами классов, потому что положительных пар меньше "негативных".

Метрики: ROC-AUC ≈ 0.93 и Accuracy ≈ 0.97 на тесте.